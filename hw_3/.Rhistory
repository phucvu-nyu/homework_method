}
score_calculate<-function(y,X,beta){
scores<-lapply(1:length(y),function(x) score_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,scores))
}
information_calculate<-function(y,X,beta){
infos<-lapply(1:length(y),function(x) information_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,infos))
}
data<-read.csv("/Users/quangphucvu/Downloads/hers.csv")
data<-na.omit(data)
Y<-data$LDL
X<-as.matrix(data |> select(BMI,age))
real_X<-cbind(rep(1,dim(X)[1]),X)
lapply(1:length(Y),function(x) score_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=x))
information_calculate(y=Y,X=real_X,beta=c(0,0,0))
library(dplyr)
score_i_calculate<-function(y,X,beta,i){
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
information_i_calculate<-function(y,X,beta,i){
info<-exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2*(t(X[i,])%*%X[i,])
return(info)
}
distance_calculation<-function(beta_1,beta_2){
distance<-sum((beta_1-beta_2)^2)
return(distance)
}
score_calculate<-function(y,X,beta){
scores<-lapply(1:length(y),function(x) score_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,scores))
}
information_calculate<-function(y,X,beta){
infos<-lapply(1:length(y),function(x) information_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,infos))
}
data<-read.csv("/Users/quangphucvu/Downloads/hers.csv")
data<-na.omit(data)
Y<-data$LDL
X<-as.matrix(data |> select(BMI,age))
real_X<-cbind(rep(1,dim(X)[1]),X)
information_calculate(y=Y,X=real_X,beta=c(0,0,0))
information_calculate(y=Y,X=real_X,beta=c(0,0,1))
information_calculate(y=Y,X=real_X,beta=c(0,0,1))
score_i_calculate<-function(y,X,beta,i){
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
information_calculate(y=Y,X=real_X,beta=c(0,0,1))
information_i_calculate<-function(y,X,beta,i){
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(X[i,]%*%t(X[i,]))
return(info)
}
information_calculate(y=Y,X=real_X,beta=c(0,0,1))
information_i_calculate<-function(y,X,beta,i){
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(t(X[i,])%*%X[i,])
return(info)
}
information_calculate(y=Y,X=real_X,beta=c(0,0,1))
score_i_calculate(y=Y,X=real_X,beta=c(0,0,0),i=1)
data<-read.csv("/Users/quangphucvu/Downloads/hers.csv")
data<-na.omit(data)
Y<-data$LDL
X<-as.matrix(data |> select(BMI,age))
real_X<-cbind(rep(1,dim(X)[1]),X)
score_i_calculate<-function(y,X,beta,i){
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
score_i_calculate(y=Y,X=real_X,beta=c(0,0,0),i=1)
score_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
score_i_calculate(y=Y,X=real_X,beta=c(0,10,20),i=1)
score_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
score_i_calculate<-function(y,X,beta,i){
browser()
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
score_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))
(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,])
X[i,]
(1+exp(-(y[i]-X[i,]%*%beta))))
(1+exp(-(y[i]-X[i,]%*%beta)))
-(y[i]-X[i,]%*%beta
)
(y[i]-X[i,]%*%beta)
exp(-(y[i]-X[i,]%*%beta))
-(y[i]-X[i,]%*%beta)
y[i]
X[i,]%*%beta
X[i,]
beta
-(y[i]-X[i,]%*%beta)
1+exp(-(y[i]-X[i,]%*%beta))
(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta)))
)
as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
score_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
score_i_calculate<-function(y,X,beta,i){
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
score_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
information_i_calculate<-function(y,X,beta,i){
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(t(X[i,])%*%X[i,])
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
information_i_calculate<-function(y,X,beta,i){
browser()
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(t(X[i,])%*%X[i,])
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)
(exp(-(y[i]-X[i,]%*%beta)
*-2
)
)
exp(-(y[i]-X[i,]%*%beta)
)
(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)
t(X[i,])%*%X[i,]
information_i_calculate<-function(y,X,beta,i){
browser()
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(X[i,]%*%t(X[i,]))
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,3,4),i=1)
(X[i,]%*%t(X[i,]))
score_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_i_calculate<-function(y,X,beta,i){
info<-(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)*(X[i,]%*%t(X[i,]))
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_i_calculate<-function(y,X,beta,i){
scaler<-exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2
matrix<-X[i,]%*%t(X[i,])
info<-scaler*matrix
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_i_calculate<-function(y,X,beta,i){
scaler<-exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2
matrix<-X[i,]%*%t(X[i,])
info<-matrix*scaler
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_i_calculate<-function(y,X,beta,i){
scaler<-exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2
matrix<-X[i,]%*%t(X[i,])
browser()
info<-matrix*scaler
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
scaler
matrix
scaler*matrix
information_i_calculate<-function(y,X,beta,i){
scaler<-as.numeric(exp(-(y[i]-X[i,]%*%beta)*-2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)
matrix<-X[i,]%*%t(X[i,])
info<-matrix*scaler
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
score_calculate<-function(y,X,beta){
scores<-lapply(1:length(y),function(x) score_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,scores))
}
score_calculate(y=Y,X=real_X,beta=c(0,1,2))
information_calculate<-function(y,X,beta){
infos<-lapply(1:length(y),function(x) information_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,infos))
}
information_calculate(y=Y,X=real_X,beta=c(0,1,2))
solve(information_calculate(Y,real_X,c(0,1,2)))%*%+t(score_calculate(Y,real_X,c(0,1,2)))
Y<-log(data$LDL)
information_calculate(y=Y,X=real_X,beta=c(0,1,2))
solve(information_calculate(Y,real_X,c(0,1,2)))%*%+t(score_calculate(Y,real_X,c(0,1,2)))
distance_calculation(beta_1,beta_2)
distance_calculation<-function(beta_1,beta_2){
distance<-sum((beta_1-beta_2)^2)
return(distance)
}
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.01){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(0,1,2))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.01){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
browser()
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(0,1,2))
new_beta
Y
MLE_logistic(real_X,Y,c(4,1,2))
new_beta
lm(log(LDL)~BMI+age,data=data)
MLE_logistic(real_X,Y,c(4,0.002,-0.001))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.01){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(4,0.002,-0.001))
MLE_logistic(real_X,Y,c(4,0.002,-0.001))
MLE_logistic(real_X,Y,c(4,0.005,-0.001))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.01){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
browser()
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(4,0.005,-0.001))
new_beta
old_beta
distance
MLE_logistic(real_X,Y,c(4,0.01,-0.01))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
browser()
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(4,0.01,-0.01))
cc
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(4,0.01,-0.01))
information_i_calculate<-function(y,X,beta,i){
scaler<-as.numeric(exp(-(y[i]-X[i,]%*%beta)*2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)
matrix<-X[i,]%*%t(X[i,])
info<-matrix*scaler
return(info)
}
information_i_calculate(y=Y,X=real_X,beta=c(0,1,2),i=1)
information_calculate<-function(y,X,beta){
infos<-lapply(1:length(y),function(x) information_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,infos))
}
information_calculate(y=Y,X=real_X,beta=c(0,1,2))
solve(information_calculate(Y,real_X,c(0,1,2)))%*%+t(score_calculate(Y,real_X,c(0,1,2)))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(4,0.01,-0.01))
MLE_logistic(real_X,Y,c(3,2,0.5))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
browser()
}
return(initial_beta)
}
MLE_logistic(real_X,Y,c(3,2,0.5))
old_beta
new_beta
old_beta
new_beta
solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
information_calculate(y,X,old_beta)
solve(information_calculate(y,X,old_beta))
solve(information_calculate(y,X,old_beta))%*%information_calculate(y,X,old_beta)
solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
t(score_calculate(y,X,old_beta))
solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance
distance_calculation(new_beta,old_beta)
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<100)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(new_beta)
}
MLE_logistic(real_X,Y,c(3,2,0.5))
lm(log(LDL)~BMI+age,data=data)
MLE_logistic(real_X,Y,c(3,2,0.5))
MLE_logistic(real_X,Y,c(4,0.1,0.5))
lm(log(LDL)~BMI+age,data=data)
MLE_logistic(real_X,Y,c(3,0.1,0.5))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
return(new_beta)
}
MLE_logistic(real_X,Y,c(3,0.1,0.5))
MLE_logistic(real_X,Y,c(3,1,2))
MLE_logistic(real_X,Y,c(3,1,0.2))
lm(log(LDL)~BMI+age,data=data)
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
print(i)
return(new_beta)
}
MLE_logistic(real_X,Y,c(3,1,0.2))
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
print(i)
return(new_beta)
}
MLE_logistic(real_X,Y,c(3,1,2))
MLE_logistic(real_X,Y,c(3,2,0.2))
MLE_logistic(real_X,Y,c(3,1,0.2))
lm(log(LDL)~BMI+age,data=data)
MLE_logistic<-function(X,y,initial_beta=NULL,epsilon=0.0001){
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
print(i)
return(new_beta)
}
MLE_logistic(real_X,Y,c(3,2,0.2))
MLE_logistic(real_X,Y,c(3,2,1))
X<-as.matrix(data |> select(c(BMI,age)))
X
# Code for question 1
# helper functions
score_i_calculate<-function(y,X,beta,i){
score<-as.matrix(t(X[i,])-(2*exp(-(y[i]-X[i,]%*%beta))/(1+exp(-(y[i]-X[i,]%*%beta))))%*%t(X[i,]))
return(score)
}
information_i_calculate<-function(y,X,beta,i){
scaler<-as.numeric(exp(-(y[i]-X[i,]%*%beta)*2)/(1+exp(-(y[i]-X[i,]%*%beta)))^2)
matrix<-X[i,]%*%t(X[i,])
info<-matrix*scaler
return(info)
}
distance_calculation<-function(beta_1,beta_2){
distance<-sum((beta_1-beta_2)^2)
return(distance)
}
score_calculate<-function(y,X,beta){
scores<-lapply(1:length(y),function(x) score_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,scores))
}
information_calculate<-function(y,X,beta){
infos<-lapply(1:length(y),function(x) information_i_calculate(y=y,X=X,beta=beta,i=x))
return(Reduce(`+`,infos))
}
# main function
MLE_logistic<-function(X=NULL,y=NULL,initial_beta=NULL,epsilon=0.01){
# data preparation
X <- cbind(rep(1,dim(X)[1]),X)
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
print(i)
return(new_beta)
}
MLE_logistic<-function(X=NULL,y=NULL,initial_beta=NULL,epsilon=0.001){
# data preparation
X <- cbind(rep(1,dim(X)[1]),X)
if (is.null(initial_beta)){initial_beta=as.matrix(rep(0,dim(X)[2]))}
distance<-1
i=1
new_beta<-initial_beta
while((distance>epsilon)&(i<1000)){
old_beta<-new_beta
new_beta<-old_beta+solve(information_calculate(y,X,old_beta))%*%t(score_calculate(y,X,old_beta))
distance<-distance_calculation(new_beta,old_beta)
i<-i+1
}
print(i)
return(new_beta)
}
data<-read.csv("/Users/quangphucvu/Downloads/hers.csv")
data<-na.omit(data)
Y<-log(data$LDL)
X<-as.matrix(data |> select(c(BMI)))
MLE_logistic(X=X,y=Y,initial_beta = c(4.94,0),epsilon = 0.001)
epa<-read.table("epa.dat")
epa
epa<-read.table("epa.dat",header=TRUE)
epa
epa
epa<-read.table("epa.dat",header=TRUE)
model3a<- lm(uptake~time + I(time^2)+treatment,data=epa)
summary(model3a)
epa
epa<-read.table("epa.dat",header=TRUE)
model3a<- lm(uptake~time + I(time^2)+treatment,data=epa)
summary(model3a)
model3b<-lm(uptake~treatment,data=epa)
anova(model3b,model3a)
model3c<-lm(uptake~time*treatment + I(time^2)*treatment+treatment,data=epa)
anova(model3a, model3c)
